import { Uint256, bigIntToUint256 } from '@ylide/sdk';
import SmartBuffer from '@ylide/smart-buffer';
import { Contract } from 'web3-eth-contract';
import { AbiItem } from 'web3-utils';
import Web3 from 'web3';
import { publicKeyToBigIntString } from '../misc';

export class MailerContract {
	readonly contractAddress: string;
	readonly contract: Contract;

	constructor(private readonly web3: Web3, contractAddress: string) {
		this.contractAddress = contractAddress;
		this.contract = new this.web3.eth.Contract(MAILER_ABI.abi as AbiItem[], this.contractAddress);
	}

	async buildHash(address: string, uniqueId: number, time: number): Promise<Uint256> {
		const lowerAddress = address.toLowerCase();
		const cleanHexAddress = lowerAddress.startsWith('0x') ? lowerAddress.substring(2) : lowerAddress;
		const addressBytes = SmartBuffer.ofHexString(''.padStart(24, '0') + cleanHexAddress).bytes;
		const args = {
			senderAddress: publicKeyToBigIntString(addressBytes),
			uniqueId,
			time,
		};
		const result: any = await this.contract.methods.buildHash(args).call();
		return bigIntToUint256(BigInt(result._hash).toString(10));
	}

	async estimateAndCall(address: string, method: string, args: any[]) {
		const data = this.web3.eth.abi.encodeFunctionCall(
			(MAILER_ABI.abi as AbiItem[]).find(t => t.name === method)!,
			args,
		);
		const gasPrice = await this.web3.eth.getGasPrice();
		const gas = await this.web3.eth.estimateGas({
			to: this.contract.options.address,
			data,
		});
		return await this.contract.methods[method](...args).send({ from: address, gas, gasPrice });
	}

	async setFees(address: string, _contentPartFee: bigint, _recipientFee: bigint) {
		return await this.estimateAndCall(address, 'setFees', [
			_contentPartFee.toString(10),
			_recipientFee.toString(10),
		]);
	}

	async transferOwnership(address: string, newOwner: string) {
		return await this.estimateAndCall(address, 'transferOwnership', [newOwner]);
	}

	async setBeneficiary(address: string, _beneficiary: string) {
		return await this.estimateAndCall(address, 'setBeneficiary', [_beneficiary]);
	}

	async addRecipients(
		address: string,
		uniqueId: number,
		initTime: number,
		recipients: Uint256[],
		keys: Uint8Array[],
	) {
		// uint32 uniqueId, uint32 initTime, address[] recipients, bytes[] keys
		return await this.estimateAndCall(address, 'addRecipients', [
			uniqueId,
			initTime,
			recipients.map(r => '0x' + r),
			keys.map(k => '0x' + new SmartBuffer(k).toBase64String()),
		]);
	}

	async sendMultipartMailPart(
		address: string,
		uniqueId: number,
		initTime: number,
		parts: number,
		partIdx: number,
		content: Uint8Array,
	) {
		return await this.estimateAndCall(address, 'sendMultipartMailPart', [
			uniqueId,
			initTime,
			parts,
			partIdx,
			'0x' + new SmartBuffer(content).toHexString(),
		]);
	}

	async broadcastMail(address: string, uniqueId: number, content: Uint8Array) {
		return await this.estimateAndCall(address, 'broadcastMail', [
			uniqueId,
			'0x' + new SmartBuffer(content).toHexString(),
		]);
	}

	async broadcastMailHeader(address: string, uniqueId: number, initTime: number) {
		return await this.estimateAndCall(address, 'broadcastMailHeader', [uniqueId, initTime]);
	}

	async sendSmallMail(address: string, uniqueId: number, recipient: Uint256, key: Uint8Array, content: Uint8Array) {
		return await this.estimateAndCall(address, 'sendSmallMail', [
			uniqueId,
			'0x' + recipient,
			'0x' + new SmartBuffer(key).toHexString(),
			'0x' + new SmartBuffer(content).toHexString(),
		]);
	}

	async sendBulkMail(
		address: string,
		uniqueId: number,
		recipients: Uint256[],
		keys: Uint8Array[],
		content: Uint8Array,
	) {
		return await this.estimateAndCall(address, 'sendBulkMail', [
			uniqueId,
			recipients.map(r => '0x' + r),
			keys.map(k => '0x' + new SmartBuffer(k).toHexString()),
			'0x' + new SmartBuffer(content).toHexString(),
		]);
	}
}

export const MAILER_ABI = {
	_format: 'hh-sol-artifact-1',
	contractName: 'YlideMailerV5',
	sourceName: 'contracts/YlideMailerV5.sol',
	abi: [
		{
			inputs: [],
			stateMutability: 'nonpayable',
			type: 'constructor',
		},
		{
			anonymous: false,
			inputs: [
				{
					indexed: true,
					internalType: 'address',
					name: 'sender',
					type: 'address',
				},
				{
					indexed: false,
					internalType: 'uint256',
					name: 'msgId',
					type: 'uint256',
				},
			],
			name: 'MailBroadcast',
			type: 'event',
		},
		{
			anonymous: false,
			inputs: [
				{
					indexed: true,
					internalType: 'uint256',
					name: 'msgId',
					type: 'uint256',
				},
				{
					indexed: true,
					internalType: 'address',
					name: 'sender',
					type: 'address',
				},
				{
					indexed: false,
					internalType: 'uint16',
					name: 'parts',
					type: 'uint16',
				},
				{
					indexed: false,
					internalType: 'uint16',
					name: 'partIdx',
					type: 'uint16',
				},
				{
					indexed: false,
					internalType: 'bytes',
					name: 'content',
					type: 'bytes',
				},
			],
			name: 'MailContent',
			type: 'event',
		},
		{
			anonymous: false,
			inputs: [
				{
					indexed: true,
					internalType: 'uint256',
					name: 'recipient',
					type: 'uint256',
				},
				{
					indexed: true,
					internalType: 'address',
					name: 'sender',
					type: 'address',
				},
				{
					indexed: false,
					internalType: 'uint256',
					name: 'msgId',
					type: 'uint256',
				},
				{
					indexed: false,
					internalType: 'bytes',
					name: 'key',
					type: 'bytes',
				},
			],
			name: 'MailPush',
			type: 'event',
		},
		{
			inputs: [
				{
					internalType: 'uint32',
					name: 'uniqueId',
					type: 'uint32',
				},
				{
					internalType: 'uint32',
					name: 'initTime',
					type: 'uint32',
				},
				{
					internalType: 'uint256[]',
					name: 'recipients',
					type: 'uint256[]',
				},
				{
					internalType: 'bytes[]',
					name: 'keys',
					type: 'bytes[]',
				},
			],
			name: 'addRecipients',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [],
			name: 'beneficiary',
			outputs: [
				{
					internalType: 'address payable',
					name: '',
					type: 'address',
				},
			],
			stateMutability: 'view',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'uint32',
					name: 'uniqueId',
					type: 'uint32',
				},
				{
					internalType: 'bytes',
					name: 'content',
					type: 'bytes',
				},
			],
			name: 'broadcastMail',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'uint32',
					name: 'uniqueId',
					type: 'uint32',
				},
				{
					internalType: 'uint32',
					name: 'initTime',
					type: 'uint32',
				},
			],
			name: 'broadcastMailHeader',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'uint256',
					name: 'senderAddress',
					type: 'uint256',
				},
				{
					internalType: 'uint32',
					name: 'uniqueId',
					type: 'uint32',
				},
				{
					internalType: 'uint32',
					name: 'time',
					type: 'uint32',
				},
			],
			name: 'buildHash',
			outputs: [
				{
					internalType: 'uint256',
					name: '_hash',
					type: 'uint256',
				},
			],
			stateMutability: 'pure',
			type: 'function',
		},
		{
			inputs: [],
			name: 'contentPartFee',
			outputs: [
				{
					internalType: 'uint128',
					name: '',
					type: 'uint128',
				},
			],
			stateMutability: 'view',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'uint256',
					name: 'senderAddress',
					type: 'uint256',
				},
				{
					internalType: 'uint32',
					name: 'uniqueId',
					type: 'uint32',
				},
				{
					internalType: 'uint32',
					name: 'initTime',
					type: 'uint32',
				},
			],
			name: 'getMsgId',
			outputs: [
				{
					internalType: 'uint256',
					name: 'msgId',
					type: 'uint256',
				},
			],
			stateMutability: 'pure',
			type: 'function',
		},
		{
			inputs: [],
			name: 'owner',
			outputs: [
				{
					internalType: 'address',
					name: '',
					type: 'address',
				},
			],
			stateMutability: 'view',
			type: 'function',
		},
		{
			inputs: [],
			name: 'recipientFee',
			outputs: [
				{
					internalType: 'uint128',
					name: '',
					type: 'uint128',
				},
			],
			stateMutability: 'view',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'uint32',
					name: 'uniqueId',
					type: 'uint32',
				},
				{
					internalType: 'uint256[]',
					name: 'recipients',
					type: 'uint256[]',
				},
				{
					internalType: 'bytes[]',
					name: 'keys',
					type: 'bytes[]',
				},
				{
					internalType: 'bytes',
					name: 'content',
					type: 'bytes',
				},
			],
			name: 'sendBulkMail',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'uint32',
					name: 'uniqueId',
					type: 'uint32',
				},
				{
					internalType: 'uint32',
					name: 'initTime',
					type: 'uint32',
				},
				{
					internalType: 'uint16',
					name: 'parts',
					type: 'uint16',
				},
				{
					internalType: 'uint16',
					name: 'partIdx',
					type: 'uint16',
				},
				{
					internalType: 'bytes',
					name: 'content',
					type: 'bytes',
				},
			],
			name: 'sendMultipartMailPart',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'uint32',
					name: 'uniqueId',
					type: 'uint32',
				},
				{
					internalType: 'uint256',
					name: 'recipient',
					type: 'uint256',
				},
				{
					internalType: 'bytes',
					name: 'key',
					type: 'bytes',
				},
				{
					internalType: 'bytes',
					name: 'content',
					type: 'bytes',
				},
			],
			name: 'sendSmallMail',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'address payable',
					name: '_beneficiary',
					type: 'address',
				},
			],
			name: 'setBeneficiary',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'uint128',
					name: '_contentPartFee',
					type: 'uint128',
				},
				{
					internalType: 'uint128',
					name: '_recipientFee',
					type: 'uint128',
				},
			],
			name: 'setFees',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [],
			name: 'terminate',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
		{
			inputs: [
				{
					internalType: 'address',
					name: 'newOwner',
					type: 'address',
				},
			],
			name: 'transferOwnership',
			outputs: [],
			stateMutability: 'nonpayable',
			type: 'function',
		},
	],
	bytecode:
		'0x60806040526000600160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055506000600160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555034801561008457600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555033600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550611e57806101156000396000f3fe608060405234801561001057600080fd5b50600436106101005760003560e01c806340bda40211610097578063c655de0a11610066578063c655de0a1461025f578063df6d3d3c1461027b578063ef83767014610297578063f2fde38b146102c757610100565b806340bda402146101eb57806345c6c8581461020957806362dc23f3146102255780638da5cb5b1461024157610100565b80631f2dcdbc116100d35780631f2dcdbc1461016557806332760c7a1461018157806338af3eed1461019d578063409537a9146101bb57610100565b80630c08bf88146101055780631918b8fa1461010f5780631c31f7101461012b5780631eecf50014610147575b600080fd5b61010d6102e3565b005b610129600480360381019061012491906111f0565b610374565b005b610145600480360381019061014091906112f5565b610571565b005b61014f61060d565b60405161015c919061134d565b60405180910390f35b61017f600480360381019061017a9190611414565b61062f565b005b61019b60048036038101906101969190611509565b6108dd565b005b6101a56109ab565b6040516101b29190611558565b60405180910390f35b6101d560048036038101906101d09190611573565b6109d1565b6040516101e291906115d5565b60405180910390f35b6101f3610a60565b604051610200919061134d565b60405180910390f35b610223600480360381019061021e91906115f0565b610a82565b005b61023f600480360381019061023a91906116d1565b610c62565b005b610249610dea565b604051610256919061178c565b60405180910390f35b610279600480360381019061027491906117a7565b610e0e565b005b61029560048036038101906102909190611807565b610fb1565b005b6102b160048036038101906102ac9190611573565b611029565b6040516102be91906115d5565b60405180910390f35b6102e160048036038101906102dc9190611873565b61103f565b005b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461033b57600080fd5b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b60006103973373ffffffffffffffffffffffffffffffffffffffff1688426109d1565b90503373ffffffffffffffffffffffffffffffffffffffff16817fd915db8013406ed60ecce0d75d05410716fffaec122c644b7a7599a0456c2d296001600087876040516103e8949392919061197e565b60405180910390a33373ffffffffffffffffffffffffffffffffffffffff16867f46235d2e0f25df2c5261b87dc0c3da0832af911941c4c8b0dda32b7be06a429e83888860405161043b939291906119be565b60405180910390a36000600160109054906101000a90046fffffffffffffffffffffffffffffffff16600160009054906101000a90046fffffffffffffffffffffffffffffffff1661048d9190611a1f565b6fffffffffffffffffffffffffffffffff16111561056857600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc600160109054906101000a90046fffffffffffffffffffffffffffffffff16600160009054906101000a90046fffffffffffffffffffffffffffffffff166105299190611a1f565b6fffffffffffffffffffffffffffffffff169081150290604051600060405180830381858888f19350505050158015610566573d6000803e3d6000fd5b505b50505050505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146105c957600080fd5b80600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b600160009054906101000a90046fffffffffffffffffffffffffffffffff1681565b60006106523373ffffffffffffffffffffffffffffffffffffffff1689426109d1565b90503373ffffffffffffffffffffffffffffffffffffffff16817fd915db8013406ed60ecce0d75d05410716fffaec122c644b7a7599a0456c2d296001600087876040516106a3949392919061197e565b60405180910390a360005b8787905081101561075b573373ffffffffffffffffffffffffffffffffffffffff168888838181106106e3576106e2611a65565b5b905060200201357f46235d2e0f25df2c5261b87dc0c3da0832af911941c4c8b0dda32b7be06a429e8489898681811061071f5761071e611a65565b5b90506020028101906107319190611aa3565b604051610740939291906119be565b60405180910390a3808061075390611b06565b9150506106ae565b50600087879050600160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1661079d9190611b4f565b600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166107d89190611ba9565b11156108d357600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc88889050600160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166108599190611b4f565b600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166108949190611ba9565b6fffffffffffffffffffffffffffffffff169081150290604051600060405180830381858888f193505050501580156108d1573d6000803e3d6000fd5b505b5050505050505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461093557600080fd5b81600160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555080600160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055505050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000808460001b8460e01b8460e01b6040516020016109f293929190611c77565b6040516020818303038152906040529050600281604051610a139190611d2e565b602060405180830381855afa158015610a30573d6000803e3d6000fd5b5050506040513d601f19601f82011682018060405250810190610a539190611d71565b60001c9150509392505050565b600160109054906101000a90046fffffffffffffffffffffffffffffffff1681565b6000610aa53373ffffffffffffffffffffffffffffffffffffffff1688886109d1565b905060005b85859050811015610b57573373ffffffffffffffffffffffffffffffffffffffff16868683818110610adf57610ade611a65565b5b905060200201357f46235d2e0f25df2c5261b87dc0c3da0832af911941c4c8b0dda32b7be06a429e84878786818110610b1b57610b1a611a65565b5b9050602002810190610b2d9190611aa3565b604051610b3c939291906119be565b60405180910390a38080610b4f90611b06565b915050610aaa565b50600085859050600160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16610b999190611b4f565b1115610c5957600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc86869050600160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16610c1a9190611b4f565b6fffffffffffffffffffffffffffffffff169081150290604051600060405180830381858888f19350505050158015610c57573d6000803e3d6000fd5b505b50505050505050565b8463ffffffff16421015610c7557600080fd5b6102588563ffffffff1642610c8a9190611d9e565b10610c9457600080fd5b6000610cb73373ffffffffffffffffffffffffffffffffffffffff1688886109d1565b90503373ffffffffffffffffffffffffffffffffffffffff16817fd915db8013406ed60ecce0d75d05410716fffaec122c644b7a7599a0456c2d2987878787604051610d069493929190611de1565b60405180910390a36000600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff161115610de157600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff169081150290604051600060405180830381858888f19350505050158015610ddf573d6000803e3d6000fd5b505b50505050505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000610e313373ffffffffffffffffffffffffffffffffffffffff1685426109d1565b90503373ffffffffffffffffffffffffffffffffffffffff16817fd915db8013406ed60ecce0d75d05410716fffaec122c644b7a7599a0456c2d29600160008787604051610e82949392919061197e565b60405180910390a33373ffffffffffffffffffffffffffffffffffffffff167f75d55e49e4504de4dc180bec2876ad7b2b66e43764374a425fa153488c31fc2282604051610ed091906115d5565b60405180910390a26000600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff161115610fab57600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff169081150290604051600060405180830381858888f19350505050158015610fa9573d6000803e3d6000fd5b505b50505050565b6000610fd43373ffffffffffffffffffffffffffffffffffffffff1684846109d1565b90503373ffffffffffffffffffffffffffffffffffffffff167f75d55e49e4504de4dc180bec2876ad7b2b66e43764374a425fa153488c31fc228260405161101c91906115d5565b60405180910390a2505050565b60006110368484846109d1565b90509392505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461109757600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461110c57806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b50565b600080fd5b600080fd5b600063ffffffff82169050919050565b61113281611119565b811461113d57600080fd5b50565b60008135905061114f81611129565b92915050565b6000819050919050565b61116881611155565b811461117357600080fd5b50565b6000813590506111858161115f565b92915050565b600080fd5b600080fd5b600080fd5b60008083601f8401126111b0576111af61118b565b5b8235905067ffffffffffffffff8111156111cd576111cc611190565b5b6020830191508360018202830111156111e9576111e8611195565b5b9250929050565b6000806000806000806080878903121561120d5761120c61110f565b5b600061121b89828a01611140565b965050602061122c89828a01611176565b955050604087013567ffffffffffffffff81111561124d5761124c611114565b5b61125989828a0161119a565b9450945050606087013567ffffffffffffffff81111561127c5761127b611114565b5b61128889828a0161119a565b92509250509295509295509295565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006112c282611297565b9050919050565b6112d2816112b7565b81146112dd57600080fd5b50565b6000813590506112ef816112c9565b92915050565b60006020828403121561130b5761130a61110f565b5b6000611319848285016112e0565b91505092915050565b60006fffffffffffffffffffffffffffffffff82169050919050565b61134781611322565b82525050565b6000602082019050611362600083018461133e565b92915050565b60008083601f84011261137e5761137d61118b565b5b8235905067ffffffffffffffff81111561139b5761139a611190565b5b6020830191508360208202830111156113b7576113b6611195565b5b9250929050565b60008083601f8401126113d4576113d361118b565b5b8235905067ffffffffffffffff8111156113f1576113f0611190565b5b60208301915083602082028301111561140d5761140c611195565b5b9250929050565b60008060008060008060006080888a0312156114335761143261110f565b5b60006114418a828b01611140565b975050602088013567ffffffffffffffff81111561146257611461611114565b5b61146e8a828b01611368565b9650965050604088013567ffffffffffffffff81111561149157611490611114565b5b61149d8a828b016113be565b9450945050606088013567ffffffffffffffff8111156114c0576114bf611114565b5b6114cc8a828b0161119a565b925092505092959891949750929550565b6114e681611322565b81146114f157600080fd5b50565b600081359050611503816114dd565b92915050565b600080604083850312156115205761151f61110f565b5b600061152e858286016114f4565b925050602061153f858286016114f4565b9150509250929050565b611552816112b7565b82525050565b600060208201905061156d6000830184611549565b92915050565b60008060006060848603121561158c5761158b61110f565b5b600061159a86828701611176565b93505060206115ab86828701611140565b92505060406115bc86828701611140565b9150509250925092565b6115cf81611155565b82525050565b60006020820190506115ea60008301846115c6565b92915050565b6000806000806000806080878903121561160d5761160c61110f565b5b600061161b89828a01611140565b965050602061162c89828a01611140565b955050604087013567ffffffffffffffff81111561164d5761164c611114565b5b61165989828a01611368565b9450945050606087013567ffffffffffffffff81111561167c5761167b611114565b5b61168889828a016113be565b92509250509295509295509295565b600061ffff82169050919050565b6116ae81611697565b81146116b957600080fd5b50565b6000813590506116cb816116a5565b92915050565b60008060008060008060a087890312156116ee576116ed61110f565b5b60006116fc89828a01611140565b965050602061170d89828a01611140565b955050604061171e89828a016116bc565b945050606061172f89828a016116bc565b935050608087013567ffffffffffffffff8111156117505761174f611114565b5b61175c89828a0161119a565b92509250509295509295509295565b600061177682611297565b9050919050565b6117868161176b565b82525050565b60006020820190506117a1600083018461177d565b92915050565b6000806000604084860312156117c0576117bf61110f565b5b60006117ce86828701611140565b935050602084013567ffffffffffffffff8111156117ef576117ee611114565b5b6117fb8682870161119a565b92509250509250925092565b6000806040838503121561181e5761181d61110f565b5b600061182c85828601611140565b925050602061183d85828601611140565b9150509250929050565b6118508161176b565b811461185b57600080fd5b50565b60008135905061186d81611847565b92915050565b6000602082840312156118895761188861110f565b5b60006118978482850161185e565b91505092915050565b6000819050919050565b6000819050919050565b60006118cf6118ca6118c5846118a0565b6118aa565b611697565b9050919050565b6118df816118b4565b82525050565b6000819050919050565b600061190a611905611900846118e5565b6118aa565b611697565b9050919050565b61191a816118ef565b82525050565b600082825260208201905092915050565b82818337600083830152505050565b6000601f19601f8301169050919050565b600061195d8385611920565b935061196a838584611931565b61197383611940565b840190509392505050565b600060608201905061199360008301876118d6565b6119a06020830186611911565b81810360408301526119b3818486611951565b905095945050505050565b60006040820190506119d360008301866115c6565b81810360208301526119e6818486611951565b9050949350505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000611a2a82611322565b9150611a3583611322565b9250826fffffffffffffffffffffffffffffffff03821115611a5a57611a596119f0565b5b828201905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600080fd5b600080fd5b600080fd5b60008083356001602003843603038112611ac057611abf611a94565b5b80840192508235915067ffffffffffffffff821115611ae257611ae1611a99565b5b602083019250600182023603831315611afe57611afd611a9e565b5b509250929050565b6000611b1182611155565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415611b4457611b436119f0565b5b600182019050919050565b6000611b5a82611155565b9150611b6583611155565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0483118215151615611b9e57611b9d6119f0565b5b828202905092915050565b6000611bb482611155565b9150611bbf83611155565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115611bf457611bf36119f0565b5b828201905092915050565b6000819050919050565b6000819050919050565b611c24611c1f82611bff565b611c09565b82525050565b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b6000819050919050565b611c71611c6c82611c2a565b611c56565b82525050565b6000611c838286611c13565b602082019150611c938285611c60565b600482019150611ca38284611c60565b600482019150819050949350505050565b600081519050919050565b600081905092915050565b60005b83811015611ce8578082015181840152602081019050611ccd565b83811115611cf7576000848401525b50505050565b6000611d0882611cb4565b611d128185611cbf565b9350611d22818560208601611cca565b80840191505092915050565b6000611d3a8284611cfd565b915081905092915050565b611d4e81611bff565b8114611d5957600080fd5b50565b600081519050611d6b81611d45565b92915050565b600060208284031215611d8757611d8661110f565b5b6000611d9584828501611d5c565b91505092915050565b6000611da982611155565b9150611db483611155565b925082821015611dc757611dc66119f0565b5b828203905092915050565b611ddb81611697565b82525050565b6000606082019050611df66000830187611dd2565b611e036020830186611dd2565b8181036040830152611e16818486611951565b90509594505050505056fea264697066735822122091f7bf522f631248ebb52c8c306647d2dcecfe13d4997deef2c67e49873e5e8764736f6c63430008090033',
	deployedBytecode:
		'0x608060405234801561001057600080fd5b50600436106101005760003560e01c806340bda40211610097578063c655de0a11610066578063c655de0a1461025f578063df6d3d3c1461027b578063ef83767014610297578063f2fde38b146102c757610100565b806340bda402146101eb57806345c6c8581461020957806362dc23f3146102255780638da5cb5b1461024157610100565b80631f2dcdbc116100d35780631f2dcdbc1461016557806332760c7a1461018157806338af3eed1461019d578063409537a9146101bb57610100565b80630c08bf88146101055780631918b8fa1461010f5780631c31f7101461012b5780631eecf50014610147575b600080fd5b61010d6102e3565b005b610129600480360381019061012491906111f0565b610374565b005b610145600480360381019061014091906112f5565b610571565b005b61014f61060d565b60405161015c919061134d565b60405180910390f35b61017f600480360381019061017a9190611414565b61062f565b005b61019b60048036038101906101969190611509565b6108dd565b005b6101a56109ab565b6040516101b29190611558565b60405180910390f35b6101d560048036038101906101d09190611573565b6109d1565b6040516101e291906115d5565b60405180910390f35b6101f3610a60565b604051610200919061134d565b60405180910390f35b610223600480360381019061021e91906115f0565b610a82565b005b61023f600480360381019061023a91906116d1565b610c62565b005b610249610dea565b604051610256919061178c565b60405180910390f35b610279600480360381019061027491906117a7565b610e0e565b005b61029560048036038101906102909190611807565b610fb1565b005b6102b160048036038101906102ac9190611573565b611029565b6040516102be91906115d5565b60405180910390f35b6102e160048036038101906102dc9190611873565b61103f565b005b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461033b57600080fd5b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b60006103973373ffffffffffffffffffffffffffffffffffffffff1688426109d1565b90503373ffffffffffffffffffffffffffffffffffffffff16817fd915db8013406ed60ecce0d75d05410716fffaec122c644b7a7599a0456c2d296001600087876040516103e8949392919061197e565b60405180910390a33373ffffffffffffffffffffffffffffffffffffffff16867f46235d2e0f25df2c5261b87dc0c3da0832af911941c4c8b0dda32b7be06a429e83888860405161043b939291906119be565b60405180910390a36000600160109054906101000a90046fffffffffffffffffffffffffffffffff16600160009054906101000a90046fffffffffffffffffffffffffffffffff1661048d9190611a1f565b6fffffffffffffffffffffffffffffffff16111561056857600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc600160109054906101000a90046fffffffffffffffffffffffffffffffff16600160009054906101000a90046fffffffffffffffffffffffffffffffff166105299190611a1f565b6fffffffffffffffffffffffffffffffff169081150290604051600060405180830381858888f19350505050158015610566573d6000803e3d6000fd5b505b50505050505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146105c957600080fd5b80600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b600160009054906101000a90046fffffffffffffffffffffffffffffffff1681565b60006106523373ffffffffffffffffffffffffffffffffffffffff1689426109d1565b90503373ffffffffffffffffffffffffffffffffffffffff16817fd915db8013406ed60ecce0d75d05410716fffaec122c644b7a7599a0456c2d296001600087876040516106a3949392919061197e565b60405180910390a360005b8787905081101561075b573373ffffffffffffffffffffffffffffffffffffffff168888838181106106e3576106e2611a65565b5b905060200201357f46235d2e0f25df2c5261b87dc0c3da0832af911941c4c8b0dda32b7be06a429e8489898681811061071f5761071e611a65565b5b90506020028101906107319190611aa3565b604051610740939291906119be565b60405180910390a3808061075390611b06565b9150506106ae565b50600087879050600160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1661079d9190611b4f565b600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166107d89190611ba9565b11156108d357600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc88889050600160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166108599190611b4f565b600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166108949190611ba9565b6fffffffffffffffffffffffffffffffff169081150290604051600060405180830381858888f193505050501580156108d1573d6000803e3d6000fd5b505b5050505050505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461093557600080fd5b81600160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555080600160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055505050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000808460001b8460e01b8460e01b6040516020016109f293929190611c77565b6040516020818303038152906040529050600281604051610a139190611d2e565b602060405180830381855afa158015610a30573d6000803e3d6000fd5b5050506040513d601f19601f82011682018060405250810190610a539190611d71565b60001c9150509392505050565b600160109054906101000a90046fffffffffffffffffffffffffffffffff1681565b6000610aa53373ffffffffffffffffffffffffffffffffffffffff1688886109d1565b905060005b85859050811015610b57573373ffffffffffffffffffffffffffffffffffffffff16868683818110610adf57610ade611a65565b5b905060200201357f46235d2e0f25df2c5261b87dc0c3da0832af911941c4c8b0dda32b7be06a429e84878786818110610b1b57610b1a611a65565b5b9050602002810190610b2d9190611aa3565b604051610b3c939291906119be565b60405180910390a38080610b4f90611b06565b915050610aaa565b50600085859050600160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16610b999190611b4f565b1115610c5957600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc86869050600160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16610c1a9190611b4f565b6fffffffffffffffffffffffffffffffff169081150290604051600060405180830381858888f19350505050158015610c57573d6000803e3d6000fd5b505b50505050505050565b8463ffffffff16421015610c7557600080fd5b6102588563ffffffff1642610c8a9190611d9e565b10610c9457600080fd5b6000610cb73373ffffffffffffffffffffffffffffffffffffffff1688886109d1565b90503373ffffffffffffffffffffffffffffffffffffffff16817fd915db8013406ed60ecce0d75d05410716fffaec122c644b7a7599a0456c2d2987878787604051610d069493929190611de1565b60405180910390a36000600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff161115610de157600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff169081150290604051600060405180830381858888f19350505050158015610ddf573d6000803e3d6000fd5b505b50505050505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000610e313373ffffffffffffffffffffffffffffffffffffffff1685426109d1565b90503373ffffffffffffffffffffffffffffffffffffffff16817fd915db8013406ed60ecce0d75d05410716fffaec122c644b7a7599a0456c2d29600160008787604051610e82949392919061197e565b60405180910390a33373ffffffffffffffffffffffffffffffffffffffff167f75d55e49e4504de4dc180bec2876ad7b2b66e43764374a425fa153488c31fc2282604051610ed091906115d5565b60405180910390a26000600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff161115610fab57600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc600160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff169081150290604051600060405180830381858888f19350505050158015610fa9573d6000803e3d6000fd5b505b50505050565b6000610fd43373ffffffffffffffffffffffffffffffffffffffff1684846109d1565b90503373ffffffffffffffffffffffffffffffffffffffff167f75d55e49e4504de4dc180bec2876ad7b2b66e43764374a425fa153488c31fc228260405161101c91906115d5565b60405180910390a2505050565b60006110368484846109d1565b90509392505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461109757600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461110c57806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b50565b600080fd5b600080fd5b600063ffffffff82169050919050565b61113281611119565b811461113d57600080fd5b50565b60008135905061114f81611129565b92915050565b6000819050919050565b61116881611155565b811461117357600080fd5b50565b6000813590506111858161115f565b92915050565b600080fd5b600080fd5b600080fd5b60008083601f8401126111b0576111af61118b565b5b8235905067ffffffffffffffff8111156111cd576111cc611190565b5b6020830191508360018202830111156111e9576111e8611195565b5b9250929050565b6000806000806000806080878903121561120d5761120c61110f565b5b600061121b89828a01611140565b965050602061122c89828a01611176565b955050604087013567ffffffffffffffff81111561124d5761124c611114565b5b61125989828a0161119a565b9450945050606087013567ffffffffffffffff81111561127c5761127b611114565b5b61128889828a0161119a565b92509250509295509295509295565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006112c282611297565b9050919050565b6112d2816112b7565b81146112dd57600080fd5b50565b6000813590506112ef816112c9565b92915050565b60006020828403121561130b5761130a61110f565b5b6000611319848285016112e0565b91505092915050565b60006fffffffffffffffffffffffffffffffff82169050919050565b61134781611322565b82525050565b6000602082019050611362600083018461133e565b92915050565b60008083601f84011261137e5761137d61118b565b5b8235905067ffffffffffffffff81111561139b5761139a611190565b5b6020830191508360208202830111156113b7576113b6611195565b5b9250929050565b60008083601f8401126113d4576113d361118b565b5b8235905067ffffffffffffffff8111156113f1576113f0611190565b5b60208301915083602082028301111561140d5761140c611195565b5b9250929050565b60008060008060008060006080888a0312156114335761143261110f565b5b60006114418a828b01611140565b975050602088013567ffffffffffffffff81111561146257611461611114565b5b61146e8a828b01611368565b9650965050604088013567ffffffffffffffff81111561149157611490611114565b5b61149d8a828b016113be565b9450945050606088013567ffffffffffffffff8111156114c0576114bf611114565b5b6114cc8a828b0161119a565b925092505092959891949750929550565b6114e681611322565b81146114f157600080fd5b50565b600081359050611503816114dd565b92915050565b600080604083850312156115205761151f61110f565b5b600061152e858286016114f4565b925050602061153f858286016114f4565b9150509250929050565b611552816112b7565b82525050565b600060208201905061156d6000830184611549565b92915050565b60008060006060848603121561158c5761158b61110f565b5b600061159a86828701611176565b93505060206115ab86828701611140565b92505060406115bc86828701611140565b9150509250925092565b6115cf81611155565b82525050565b60006020820190506115ea60008301846115c6565b92915050565b6000806000806000806080878903121561160d5761160c61110f565b5b600061161b89828a01611140565b965050602061162c89828a01611140565b955050604087013567ffffffffffffffff81111561164d5761164c611114565b5b61165989828a01611368565b9450945050606087013567ffffffffffffffff81111561167c5761167b611114565b5b61168889828a016113be565b92509250509295509295509295565b600061ffff82169050919050565b6116ae81611697565b81146116b957600080fd5b50565b6000813590506116cb816116a5565b92915050565b60008060008060008060a087890312156116ee576116ed61110f565b5b60006116fc89828a01611140565b965050602061170d89828a01611140565b955050604061171e89828a016116bc565b945050606061172f89828a016116bc565b935050608087013567ffffffffffffffff8111156117505761174f611114565b5b61175c89828a0161119a565b92509250509295509295509295565b600061177682611297565b9050919050565b6117868161176b565b82525050565b60006020820190506117a1600083018461177d565b92915050565b6000806000604084860312156117c0576117bf61110f565b5b60006117ce86828701611140565b935050602084013567ffffffffffffffff8111156117ef576117ee611114565b5b6117fb8682870161119a565b92509250509250925092565b6000806040838503121561181e5761181d61110f565b5b600061182c85828601611140565b925050602061183d85828601611140565b9150509250929050565b6118508161176b565b811461185b57600080fd5b50565b60008135905061186d81611847565b92915050565b6000602082840312156118895761188861110f565b5b60006118978482850161185e565b91505092915050565b6000819050919050565b6000819050919050565b60006118cf6118ca6118c5846118a0565b6118aa565b611697565b9050919050565b6118df816118b4565b82525050565b6000819050919050565b600061190a611905611900846118e5565b6118aa565b611697565b9050919050565b61191a816118ef565b82525050565b600082825260208201905092915050565b82818337600083830152505050565b6000601f19601f8301169050919050565b600061195d8385611920565b935061196a838584611931565b61197383611940565b840190509392505050565b600060608201905061199360008301876118d6565b6119a06020830186611911565b81810360408301526119b3818486611951565b905095945050505050565b60006040820190506119d360008301866115c6565b81810360208301526119e6818486611951565b9050949350505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000611a2a82611322565b9150611a3583611322565b9250826fffffffffffffffffffffffffffffffff03821115611a5a57611a596119f0565b5b828201905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600080fd5b600080fd5b600080fd5b60008083356001602003843603038112611ac057611abf611a94565b5b80840192508235915067ffffffffffffffff821115611ae257611ae1611a99565b5b602083019250600182023603831315611afe57611afd611a9e565b5b509250929050565b6000611b1182611155565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415611b4457611b436119f0565b5b600182019050919050565b6000611b5a82611155565b9150611b6583611155565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0483118215151615611b9e57611b9d6119f0565b5b828202905092915050565b6000611bb482611155565b9150611bbf83611155565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115611bf457611bf36119f0565b5b828201905092915050565b6000819050919050565b6000819050919050565b611c24611c1f82611bff565b611c09565b82525050565b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b6000819050919050565b611c71611c6c82611c2a565b611c56565b82525050565b6000611c838286611c13565b602082019150611c938285611c60565b600482019150611ca38284611c60565b600482019150819050949350505050565b600081519050919050565b600081905092915050565b60005b83811015611ce8578082015181840152602081019050611ccd565b83811115611cf7576000848401525b50505050565b6000611d0882611cb4565b611d128185611cbf565b9350611d22818560208601611cca565b80840191505092915050565b6000611d3a8284611cfd565b915081905092915050565b611d4e81611bff565b8114611d5957600080fd5b50565b600081519050611d6b81611d45565b92915050565b600060208284031215611d8757611d8661110f565b5b6000611d9584828501611d5c565b91505092915050565b6000611da982611155565b9150611db483611155565b925082821015611dc757611dc66119f0565b5b828203905092915050565b611ddb81611697565b82525050565b6000606082019050611df66000830187611dd2565b611e036020830186611dd2565b8181036040830152611e16818486611951565b90509594505050505056fea264697066735822122091f7bf522f631248ebb52c8c306647d2dcecfe13d4997deef2c67e49873e5e8764736f6c63430008090033',
	linkReferences: {},
	deployedLinkReferences: {},
};
